import re
import matplotlib.pyplot as plt

# Função para extrair os valores do texto
def extrair_valores(texto):
    # Expressões regulares para encontrar os valores
    teste_pattern = r"Teste (\d+):"
    tempo_pattern = r"Elapsed Time: (\d+\.\d+) seconds"
    mae_pattern = r"MAE: (\d+\.\d+)"
    mse_pattern = r"MSE: ([\d+\.]+e?-?\d+)"
    r2_pattern = r"R2: (\d+\.\d+)"

    # Procura por padrões no texto
    teste_match = re.search(teste_pattern, texto)
    tempo_match = re.findall(tempo_pattern, texto)
    mae_match = re.findall(mae_pattern, texto)
    mse_match = re.findall(mse_pattern, texto)
    r2_match = re.findall(r2_pattern, texto)

    # Se não encontrar algum valor, retorna None
    if teste_match is None or tempo_match is None or mae_match is None or mse_match is None or r2_match is None:
        return None

    # Extrai os valores encontrados
    teste = int(teste_match.group(1))
    tempos = [float(tempo) for tempo in tempo_match]
    maes = [float(mae) for mae in mae_match]
    mses = [float(mse) for mse in mse_match]
    r2s = [float(r2) for r2 in r2_match]

    return teste, tempos, maes, mses, r2s

# Função para plotar os dados
def plotar_grafico(teste, tempos, maes, mses, r2s, populacao):
    # Calculando a média das métricas
    media_mae = sum(maes) / len(maes) if maes else 0
    media_mse = sum(mses) / len(mses) if mses else 0
    media_r2 = sum(r2s) / len(r2s) if r2s else 0

    # Plotando o tempo decorrido
    plt.figure(figsize=(10, 6))
    plt.plot(tempos, label="Tempo decorrido", marker='o')
    plt.xlabel("Execução")
    plt.ylabel("Tempo (segundos)")
    plt.title(f"Teste {teste} - Tempo Decorrido")
    plt.xticks(range(len(tempos)))
    plt.grid(True)
    plt.legend()

    # Salvando o gráfico como arquivo PNG
    plt.savefig(f"teste_{teste}_tempo.png")
    plt.close()

    # Plotando MAE, MSE e R2
    plt.figure(figsize=(10, 6))
    plt.plot(maes, label="MAE", marker='o')
    plt.plot(mses, label="MSE", marker='o')
    plt.plot(r2s, label="R2", marker='o')
    
    # Plotando a média das métricas
    plt.axhline(y=media_mae, color='r', linestyle='--', label=f"MAE médio: {media_mae:.2f}")
    plt.axhline(y=media_mse, color='g', linestyle='--', label=f"MSE médio: {media_mse:.2f}")
    plt.axhline(y=media_r2, color='b', linestyle='--', label=f"R2 médio: {media_r2:.2f}")

    plt.xlabel("Execução")
    plt.ylabel("Valor")
    plt.title(f"Teste {teste} - MAE, MSE, R2")
    plt.xticks(range(len(tempos)))
    plt.grid(True)
    plt.legend()

    # Salvando o gráfico como arquivo PNG
    plt.savefig(f"teste_{teste}_metricas.png")
    plt.close()


# Texto fornecido
texto = """
Teste 1:
Elapsed Time: 1829.27 seconds
Fit: 9995.71
path: 167 166 161 157 158 164 156 153 152 149 143 138 137 141 145 148 155 144 139 136 133 131 129 126 124 125 113 108 112 118 121 140 151 146 150 154 135 134 128 130 117 102 101 86 79 81 58 61 88 89 93 98 100 103 110 97 85 84 64 19 62 35 15 7 5 0 3 1 2 4 8 9 11 14 18 29 31 30 33 26 21 28 27 32 56 44 36 38 50 46 39 42 40 37 34 41 43 45 47 48 49 54 53 51 52 55 57 60 66 72 65 67 63 69 59 68 73 71 25 23 20 17 16 6 10 13 12 22 24 70 75 74 77 90 92 95 105 104 106 107 96 94 91 87 82 80 78 76 83 99 109 111 114 115 116 120 119 122 123 127 132 142 147 159 165 170 184 192 187 190 191 188 183 182 185 186 189 193 181 175 168 160 162 163 171 178 173 172 174 176 180 177 179 169
MAE: 9995.71
MSE: 9.99143e+07
R2: 0.99526

Elapsed Time: 1842.47 seconds
Fit: 10471.4
path: 67 44 36 38 33 39 42 46 50 57 55 52 51 53 47 45 40 37 43 48 54 49 41 34 30 31 29 18 14 4 8 9 11 26 21 28 27 32 59 56 63 69 76 78 80 82 87 91 96 94 95 92 90 102 118 125 124 113 112 108 101 86 77 73 68 71 74 75 79 81 70 22 24 25 23 20 17 16 13 12 10 6 2 1 3 0 5 7 15 61 58 35 62 19 64 84 85 97 89 88 93 98 100 103 110 129 126 131 133 136 139 144 155 160 162 163 168 175 181 193 189 186 182 185 178 171 173 172 174 156 153 145 148 141 137 138 121 117 105 104 106 107 115 116 120 128 130 135 140 143 149 152 151 146 150 154 157 158 161 166 164 167 169 179 177 180 176 183 188 191 190 187 192 184 170 165 159 147 142 134 132 127 123 122 119 114 111 109 99 83 72 66 60 65
MAE: 10471.4
MSE: 1.09649e+08
R2: 0.98567 

Elapsed Time: 1834.21 seconds
Fit: 10496.5
path: 12 13 10 6 7 5 0 3 1 2 4 8 9 11 14 18 29 31 34 41 49 54 48 43 45 47 53 51 52 55 57 46 50 36 38 33 39 42 40 37 30 26 21 28 27 17 20 32 44 56 59 68 73 87 92 95 94 96 91 82 80 78 76 69 63 67 65 60 66 72 83 99 109 111 114 122 123 127 119 120 116 115 107 106 104 105 117 130 135 134 128 132 142 147 159 154 150 157 158 146 151 152 149 153 156 171 178 185 186 182 173 172 174 183 176 180 177 179 169 167 164 166 161 165 170 184 192 187 188 190 191 189 193 181 175 168 163 162 160 155 144 139 133 131 136 141 148 145 137 138 143 140 121 118 125 124 126 129 97 85 84 89 88 93 98 100 103 110 113 112 108 101 102 90 86 79 81 62 64 19 35 58 61 70 75 74 77 71 25 23 16 24 22 15
MAE: 10496.5
MSE: 1.10175e+08
R2: 0.98502 

Elapsed Time: 1851.28 seconds
Fit: 9722.51
path: 166 44 141 116 48 26 46 169 15 47 5 186 75 130 56 71 94 69 39 179 24 154 29 43 155 63 102 77 151 19 137 104 16 162 72 167 30 61 193 97 178 38 78 184 189 157 28 182 135 127 134 115 138 32 50 80 90 165 131 100 13 51 58 142 66 128 101 175 164 84 117 70 172 59 79 103 159 98 156 42 145 132 152 105 92 114 110 21 171 3 188 126 17 12 85 55 173 20 168 83 148 176 143 185 140 9 180 33 153 74 37 53 88 25 34 86 7 119 160 121 158 123 68 73 113 106 62 111 174 35 112 183 108 64 191 45 125 6 136 67 41 54 60 124 150 99 149 10 87 177 36 89 22 23 147 27 120 163 146 107 190 18 49 192 81 65 40 11 122 118 95 139 52 133 1 76 170 82 96 161 181 144 4 31 2 93 187 14 129 109 0 91 57 8
MAE: 9722.51
MSE: 9.45271e+07
R2: 0.99843

Elapsed Time: 1848.19 seconds
Fit: 10101.2
path: 70 0 168 148 51 113 90 125 43 58 91 163 48 64 85 108 175 67 162 101 191 82 62 139 27 145 10 99 6 15 190 123 13 100 167 169 33 81 112 114 126 178 84 180 152 186 188 76 1 80 130 68 132 115 41 127 189 72 119 105 174 61 116 56 181 94 18 97 146 156 3 4 155 12 192 135 36 42 137 120 193 35 45 34 103 29 107 55 83 151 46 87 21 11 172 128 66 118 40 106 52 147 14 92 44 177 173 74 134 184 47 164 16 185 171 93 65 182 5 75 54 158 8 20 7 50 73 131 143 49 179 161 26 2 79 19 109 154 140 32 111 39 150 133 31 183 136 157 122 102 121 144 129 37 69 22 77 160 63 9 153 149 187 53 28 124 98 78 24 110 170 57 60 176 89 159 25 104 71 17 38 141 95 59 96 138 23 165 30 86 166 88 142 117
MAE: 10101.2
MSE: 1.02035e+08
R2: 0.99358 

Teste 2:
Elapsed Time: 1120.24 seconds
Fit: 10388.4
path: 4 71 24 164 122 62 131 109 171 155 176 174 193 33 76 144 52 38 28 51 65 179 106 180 96 167 61 188 115 25 101 20 120 162 141 146 185 158 190 32 85 117 48 26 169 128 87 191 36 183 21 91 7 163 175 168 138 39 17 0 40 113 151 73 49 94 161 124 43 77 116 1 159 69 60 102 173 13 70 54 11 121 110 67 119 156 59 10 47 104 27 186 9 14 5 12 31 57 182 152 123 149 153 100 111 58 42 184 2 35 127 137 90 170 99 142 45 82 187 166 29 108 147 6 136 64 139 160 126 130 165 53 46 19 125 107 132 92 140 181 143 80 22 66 8 84 189 81 89 30 34 133 154 79 112 150 63 55 88 16 72 105 74 114 178 56 18 145 75 44 78 41 118 83 157 148 134 98 15 172 95 3 97 23 68 50 86 93 129 135 177 37 192 103
MAE: 1036.42
MSE: 1.07417e+006
R2: 0.990047

Elapsed Time: 938.863 seconds
Fit: 10298.9
path: 6 149 21 9 4 109 71 175 116 117 60 145 170 36 160 188 131 162 63 187 83 148 23 167 135 55 37 110 38 146 180 140 42 33 14 43 3 92 1 93 120 85 45 101 15 19 53 163 119 12 26 69 111 164 79 113 126 173 58 72 166 136 96 65 151 34 8 5 154 157 77 125 138 27 2 31 29 115 132 179 98 161 66 114 142 158 147 127 62 189 18 68 46 40 64 28 84 81 153 50 0 150 107 141 184 10 137 16 190 144 152 82 13 130 178 100 182 177 61 59 47 70 87 32 155 95 169 94 67 57 156 89 80 186 76 112 22 118 78 108 104 44 134 106 24 121 193 181 41 35 172 17 129 73 105 11 7 103 139 88 191 86 54 39 102 51 56 192 171 97 48 128 124 91 159 52 185 122 30 49 143 20 165 74 123 90 183 174 168 99 176 133 75 25
MAE: 946.916
MSE: 896650
R2: 0.991546

Elapsed Time: 926.236 seconds
Fit: 10193.7
path: 178 185 186 182 183 176 180 177 179 167 164 166 169 170 184 192 187 188 190 191 189 193 181 175 168 163 153 149 143 138 137 141 145 148 162 160 155 144 139 136 133 131 129 126 124 125 118 113 112 108 101 86 77 73 68 71 74 75 70 79 81 100 103 110 98 93 88 89 97 85 84 64 19 62 35 58 61 22 24 12 15 7 5 0 3 1 2 6 10 13 16 25 23 20 17 32 59 69 63 56 44 67 65 50 46 38 36 28 27 21 26 33 39 42 40 37 30 11 9 8 4 14 18 29 31 34 43 41 49 48 54 53 45 47 51 52 55 57 60 66 72 83 76 78 80 82 87 91 96 94 95 92 90 102 105 104 106 107 99 109 111 114 115 116 120 119 122 123 127 132 128 134 142 147 159 165 161 158 157 150 154 135 130 117 121 140 146 151 152 156 174 172 173 171
MAE: 841.653
MSE: 708379
R2: 0.993183

Elapsed Time: 972.789 seconds
Fit: 10098.4
path: 116 117 130 135 134 128 120 119 122 123 127 132 142 147 159 165 161 166 169 170 184 192 187 190 191 188 183 182 185 186 189 193 181 175 168 171 178 173 172 174 176 180 177 179 167 164 158 157 154 150 146 151 140 143 149 152 156 153 138 137 141 145 148 163 162 160 155 144 139 136 133 131 129 126 124 125 113 108 112 118 121 102 92 95 105 104 106 107 96 94 91 87 90 101 86 79 81 58 61 88 89 93 98 100 103 110 97 85 84 64 19 62 35 15 7 5 0 3 1 2 6 23 25 16 13 10 12 22 24 70 75 74 77 71 73 68 59 32 20 17 27 21 28 36 44 56 63 69 67 65 50 46 38 33 39 42 47 45 40 37 30 26 11 9 8 4 14 18 29 31 34 43 41 49 48 54 53 51 52 55 57 60 66 72 76 78 80 82 83 99 109 111 114 115
MAE: 746.434
MSE: 557164
R2: 0.994536

Teste 3:
Elapsed Time: 1363.74 seconds
Fit: 10261
path: 112 118 121 117 105 95 92 102 101 90 87 82 80 78 76 69 63 56 59 68 73 71 77 74 75 86 79 70 81 61 58 35 62 64 19 15 7 5 0 3 1 2 4 8 9 11 14 18 29 31 34 30 33 26 21 28 27 17 20 16 6 10 13 12 22 24 25 23 32 44 36 38 50 46 42 39 37 40 47 45 43 41 49 48 54 53 51 52 55 57 60 66 72 65 67 83 91 94 96 104 106 107 99 109 111 114 115 116 120 119 122 123 127 132 134 128 130 135 142 147 159 165 170 169 166 167 176 180 177 179 184 192 187 183 173 172 174 164 158 157 161 154 150 146 140 151 152 156 153 149 143 138 137 141 145 148 163 171 178 185 182 186 188 190 191 189 193 181 175 168 162 160 155 144 139 136 133 131 125 124 126 129 97 85 84 89 88 93 98 100 103 110 113 108
MAE: 908.987
MSE: 826256
R2: 0.992152

Elapsed Time: 1380.42 seconds
Fit: 10121.9
path: 41 49 54 48 43 45 47 53 51 52 55 57 46 42 40 37 39 33 38 36 50 60 66 72 65 67 63 69 76 83 80 78 82 87 92 95 94 91 96 105 104 106 107 99 109 111 114 115 116 117 130 135 134 128 120 119 122 123 127 132 142 147 159 165 170 184 179 177 192 187 188 190 191 189 193 181 175 168 163 162 160 155 144 139 133 131 136 141 148 145 137 138 143 149 152 153 156 174 172 173 171 178 185 186 182 183 180 176 164 167 169 166 161 158 157 154 150 146 151 140 121 118 112 108 101 102 90 77 73 68 71 74 75 86 79 70 24 22 81 88 89 93 98 100 103 110 113 125 124 126 129 97 85 84 64 19 62 35 58 61 15 7 5 0 3 1 2 6 10 12 13 16 25 23 20 17 32 59 56 44 27 28 21 26 11 9 8 4 14 18 29 31 30 34
MAE: 769.947
MSE: 592818
R2: 0.994214

Elapsed Time: 1389.44 seconds
Fit: 9983.84
path: 62 35 58 61 81 88 89 93 98 100 103 110 113 118 112 108 101 102 90 92 95 105 117 121 140 146 151 152 149 143 153 156 164 167 166 169 179 177 180 176 183 174 172 173 182 186 185 178 171 163 148 145 141 138 137 125 124 126 129 131 133 136 139 144 155 160 162 168 175 181 193 189 191 190 188 187 192 184 170 165 161 158 157 150 154 159 147 142 135 130 128 134 132 127 123 122 119 120 116 115 114 111 109 99 107 106 104 96 94 91 87 82 78 80 83 76 69 63 44 56 59 68 73 77 86 79 70 75 74 71 25 23 20 17 32 27 28 21 26 36 38 33 39 42 46 50 67 65 72 66 60 57 55 52 51 47 45 53 54 48 49 41 43 40 37 34 30 31 29 18 14 11 9 8 4 2 1 3 6 10 13 16 24 22 12 15 7 5 0 19 64 84 85 97
MAE: 631.835
MSE: 399216
R2: 0.995995

Elapsed Time: 1395.27 seconds
Fit: 10165.2
path: 53 54 48 49 41 43 40 45 47 42 46 38 33 39 37 34 30 31 29 18 14 11 9 8 4 2 1 3 0 5 7 15 35 62 19 64 84 85 97 89 88 93 98 100 103 110 113 112 108 101 86 79 81 61 58 70 75 74 77 73 68 71 24 22 12 13 10 6 16 25 23 20 17 32 59 69 76 78 80 82 87 90 102 92 95 94 91 96 107 106 104 105 117 130 135 154 150 146 140 151 152 149 143 138 137 121 118 125 124 126 129 131 133 136 139 141 145 148 144 155 160 162 163 153 156 168 175 181 171 178 185 182 186 193 189 191 190 188 187 192 184 179 177 180 183 173 172 174 176 167 164 158 157 161 166 169 170 165 159 147 142 134 128 132 127 123 122 119 120 116 115 114 111 109 99 83 72 66 60 65 67 63 56 44 27 28 21 26 36 50 57 55 52 51
MAE: 813.186
MSE: 661271
R2: 0.9936

Elapsed Time: 1390.47 seconds
Fit: 10014.9
path: 32 25 23 20 17 27 28 21 26 33 38 46 57 55 52 51 47 45 53 54 48 49 41 43 40 42 39 37 34 30 31 29 18 14 11 9 8 4 2 1 3 6 10 12 13 16 24 22 70 75 74 71 68 73 77 90 102 101 86 79 81 61 58 35 15 7 5 0 19 62 64 84 85 97 89 88 93 98 100 103 110 113 108 112 118 125 124 126 129 131 133 136 139 144 155 160 162 168 175 181 193 189 186 185 182 183 188 191 190 187 192 184 179 177 180 176 174 172 173 178 171 163 148 145 141 137 138 143 149 152 153 156 164 158 157 161 166 167 169 170 165 159 147 142 134 132 127 123 122 119 114 115 116 120 128 130 135 154 150 146 151 140 121 117 105 104 106 107 111 109 99 96 91 94 95 92 87 82 78 80 83 76 69 63 67 65 72 66 60 50 36 44 56 59
MAE: 662.925
MSE: 439469
R2: 0.995618
"""

# População para cada teste
populacao = {1: 31, 2: 67, 3: 103}

# Dividindo o texto em partes separadas para cada teste
testes = texto.split("Teste")

# Iterando sobre cada parte do texto
for parte in testes[1:]:
    # Extrai os valores de cada parte
    valores = extrair_valores("Teste" + parte)

    # Se os valores forem extraídos com sucesso, plotar o gráfico
    if valores:
        teste, tempos, maes, mses, r2s = valores
        plotar_grafico(teste, tempos, maes, mses, r2s, populacao[teste])

print("Gráficos gerados com sucesso!")